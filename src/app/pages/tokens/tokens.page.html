<ion-content class="ion-padding">
  <ion-item lines="none">
    <ion-input
      placeholder="Filtrer par label / scope…"
      [ngModel]="q()"
      [ngModelOptions]="{standalone:true}"
      (ionInput)="q.set($event.detail.value || '')"></ion-input>
    <ion-button fill="outline" (click)="openCreate()">Nouveau token</ion-button>
  </ion-item>

  <ion-list>
    @for (t of filtered(); track t?.id) {
      <ion-item>
        <ion-label>
          <h2>
            {{ t?.label || '—' }}
            @if (t?.revoked_at) {
              <ion-badge color="medium">révoqué</ion-badge>
            }
          </h2>
          <p>Scopes: {{ (t?.scopes || []).join(', ') }}</p>
          <p>Créé: {{ t?.created_at }} — Révoqué: {{ t?.revoked_at || 'non' }}</p>
        </ion-label>
        <ion-buttons slot="end">
          <ion-button color="danger" [disabled]="!!t?.revoked_at" (click)="confirmRevoke(t)">Révoquer</ion-button>
        </ion-buttons>
      </ion-item>
    }
  </ion-list>

  @if (!filtered().length) {
    <ion-item lines="none">
      <ion-label>Aucun token. Cliquez sur <b>Créer</b> pour démarrer.</ion-label>
    </ion-item>
  }

</ion-content>
