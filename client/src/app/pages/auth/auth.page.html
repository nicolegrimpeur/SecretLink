<ion-content>
  <div class="auth-container">
    <ion-card class="auth-card">
      <ion-card-header>
        <ion-card-title class="title">
          <ion-icon [name]="icon()"></ion-icon>
          {{ title() }}
        </ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <ion-segment [value]="mode()" (ionChange)="switchMode($event.detail.value ?? mode())">
          <ion-segment-button value="login">
            <ion-label>Connexion</ion-label>
          </ion-segment-button>
          <ion-segment-button value="signup">
            <ion-label>Inscription</ion-label>
          </ion-segment-button>
        </ion-segment>

        <form [formGroup]="form" (ngSubmit)="submit()" class="form">
          <ion-item lines="none" [class.ion-invalid]="isInvalid('email')">
            <ion-input
              label="Email"
              type="email"
              formControlName="email"
              helperText="Entrez votre adresse email"
              [errorText]="errorFor('email') || ''"
              [required]="true"
              autocomplete="email">
            </ion-input>
          </ion-item>

          <ion-item lines="none" [class.ion-invalid]="isInvalid('password')">
            <ion-input
              label="Mot de passe"
              type="password"
              formControlName="password"
              [helperText]="'Entrez votre mot de passe' + (mode() === 'login' ? '' : ' (8 caractères minimum)')"
              [errorText]="errorFor('password') || ''"
              [required]="true"
              [autocomplete]="mode() === 'login' ? 'current-password' : 'new-password'">
              <ion-input-password-toggle slot="end"></ion-input-password-toggle>
            </ion-input>
          </ion-item>

          <div class="confirm-accordion" [class.open]="mode() === 'signup'">
            <div class="confirm-inner">
              <ion-item lines="none" [class.ion-invalid]="isInvalid('passwordConfirm')">
                <ion-input
                  label="Confirmer le mot de passe"
                  type="password"
                  formControlName="passwordConfirm"
                  [required]="mode() === 'signup'"
                  helperText="Confirmez votre mot de passe"
                  [errorText]="errorFor('passwordConfirm') || ''"
                  autocomplete="new-password">
                  <ion-input-password-toggle slot="end"></ion-input-password-toggle>
                </ion-input>
              </ion-item>
              <ion-item lines="none">
                <ion-checkbox formControlName="termsAccepted" justify="start">
                  <ion-label class="ion-text-wrap">
                    J’ai lu et j’accepte la
                    <a routerLink="/privacy" (click)="$event.stopPropagation()" target="_blank">Politique de confidentialité</a>.
                  </ion-label>
                </ion-checkbox>
              </ion-item>
            </div>
          </div>

          <ion-button expand="block" type="submit" [disabled]="!form.valid">
            {{ submitLabel() }}
          </ion-button>

          @if (error()) {
            <ion-text color="danger">{{ error() }}</ion-text>
          }
        </form>
      </ion-card-content>

      <ion-card-content class="alt-link">
        <ion-label>
          {{ altQuestion() }}
          <span (click)="switchMode(altTarget())">
            {{ altActionLabel() }}
          </span>
        </ion-label>
      </ion-card-content>
    </ion-card>
  </div>
</ion-content>
